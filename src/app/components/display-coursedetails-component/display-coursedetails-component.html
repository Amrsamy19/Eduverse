@let data = (course | async);
<!-- header -->
<div class="flex items-center justify-between mb-12 sm:mb-16">
  <button
    (click)="goBack()"
    class="relative ms-3 text-violet-900 border-2 rounded-full p-2 md:p-5 border-violet-900 hover:cursor-pointer hover:text-violet-500 hover:border-violet-500 hover:scale-105 transition duration-150 whitespace-nowrap"
  >
    <svg
      class="md:w-7 md:h-7 w-3 h-3 left-0 top-0 absolute translate-1/4"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M10 19l-7-7m0 0l7-7m-7 7h18"
      ></path>
    </svg>
  </button>
  <h2
    class="text-2xl md:text-4xl lg:text-5x6l font-extrabold bg-clip-text text-transparent bg-gradient-to-br from-violet-950 via-violet-800 to-violet-500 tracking-tight absolute left-1/2 transform -translate-x-1/2 capitalize"
  >
    {{ data?.courseName }}
</h2>
  <button
    class="relative me-3 text-violet-900 border-2 rounded-full p-2 md:p-5 border-violet-900 hover:cursor-pointer hover:text-violet-500 hover:border-violet-500 hover:scale-105 transition duration-150 whitespace-nowrap group"
    (click)="handleWatchLater()"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="lucide lucide-clock-plus-icon lucide-clock-plus md:w-7 md:h-7 w-3 h-3 left-0 top-0 absolute translate-1/5 transition duration-150 group-hover:stroke-violet-600"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M12 6v6l3.644 1.822" />
      <path d="M16 19h6" />
      <path d="M19 16v6" />
      <path d="M21.92 13.267a10 10 0 1 0-8.653 8.653" />
    </svg>
  </button>
</div>
<!-- Card Grid Container -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
  <!-- left side -->
  <section class="lg:col-span-2 flex flex-col gap-6">
    <!-- Course Image -->
    <div class="w-full">
      <img
        src="https://img.freepik.com/premium-photo/setup-analytics-concept-illustration_1029473-87369.jpg?semt=ais_hybrid&w=740&q=80"
        alt="Course visual illustration"
        class="w-full lg:max-h-52 rounded-xl shadow-lg object-cover"
      />
    </div>

    <!-- Course Program Outline  -->
    <div class="w-full p-6 bg-white rounded-xl border border-gray-200 shadow-md">
      <h3
        class="text-xl md:text-2xl font-bold text-violet-900 mb-4 border-b pb-2 border-violet-200"
      >
        üìö Course Program Outline
      </h3>

      <div class="space-y-4">
        @for(outline of data?.outline; track outline.title; let i = $index){
        <div>
          <h4 class="text-lg font-semibold text-violet-800 flex items-center mb-1">
            <span class="text-violet-900 mr-2">{{ i + 1 }}.</span> {{ outline.title }}
          </h4>
          <p class="text-sm text-gray-600 pl-6">
            Setting up your development environment, understanding client-server architecture, and
            basic Git.
          </p>
        </div>
        }
      </div>
    </div>
  </section>

  <!-- right side -->
  <section class="lg:col-span-1 flex flex-col gap-3 lg:gap-6">
    <!-- Course Snapshot  -->
    <div class="w-full lg:h-52 p-4 bg-violet-50 rounded-xl border border-gray-200">
      <h3 class="text-xl font-bold text-violet-800 mb-4">Course Snapshot</h3>

      <div class="flex items-center justify-between py-2 border-b border-gray-200">
        <span class="text-gray-600 font-medium">‚è≥ Course Hours:</span>
        <span class="text-lg font-semibold text-violet-900">{{ data?.hours }} hrs</span>
      </div>

      <div class="flex items-center justify-between py-2 border-b border-gray-200">
        <span class="text-gray-600 font-medium">‚≠ê Reviews:</span>
        <span class="text-lg font-semibold text-amber-500">4.8 (850)</span>
      </div>

      <div class="flex items-center justify-between pt-2">
        <span class="text-gray-600 font-medium">üéØ Target Audience:</span>
        <span
          class="px-3 py-1 bg-green-100 text-green-700 text-sm font-bold uppercase tracking-wider rounded-full"
        >
          {{ data?.targetAudience }}
        </span>
      </div>
    </div>

    <!-- price and add To cart -->
    <div
      class="w-full p-6 bg-gradient-to-br from-green-400 to-green-200 text-white rounded-xl shadow-lg flex flex-col items-center"
    >
      <p class="text-sm font-medium mb-1">Total Course Price</p>
      <h4 class="text-4xl font-black mb-4">${{ data?.price }}</h4>
      <button
        (click)="addToCart(data!)"
        [disabled]="!isInCart"
        class="w-full text-center py-3 bg-white text-green-500 font-extrabold text-lg rounded-lg shadow-md transition duration-300 cursor-pointer group flex items-center justify-center gap-2"
        [ngClass]="{
          'pointer-events-none cursor-default opacity-70': isInCart(data!._id)
        }"
      >
        {{ isInCart(data!._id) ? 'Added to Cart' : 'Add to Cart' }}
        @if (isInCart(data!._id)) {
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-check-icon lucide-check"
        >
          <path d="M20 6 9 17l-5-5" />
        </svg>
        } @else {

        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-arrow-right-icon lucide-arrow-right group-hover:translate-x-5 transition duration-300"
        >
          <path d="M5 12h14" />
          <path d="m12 5 7 7-7 7" />
        </svg>
        }
      </button>
      <p class="text-xs mt-2 opacity-80 text-gray-500">
        Lifetime access & 30-day money-back guarantee.
      </p>
    </div>

    <!-- Course Overview  -->
    <div class="w-full p-6 bg-violet-50 rounded-xl shadow-inner">
      <h3 class="text-2xl font-bold text-violet-900 mb-4 border-b pb-2 border-violet-200">
        Course Overview
      </h3>

      <div
        id="courseDescription"
        class="text-gray-700 mb-3 leading-relaxed transition-all duration-500"
        [ngClass]="{
          'h-24': isCollapsed,
          'line-clamp-4': isCollapsed,
          'overflow-hidden': isCollapsed,
          'h-auto': !isCollapsed
        }"
      >
        <p>
          {{ data?.description }}
        </p>
      </div>

      <button
        (click)="toggleDescription()"
        class="text-violet-700 font-semibold hover:text-violet-900 text-sm mb-6 flex items-center"
      >
        <span id="buttonText">{{ isCollapsed ? 'See Full Description' : 'Show Less' }}</span>

        <svg
          id="toggleIcon"
          class="w-4 h-4 ml-1 transition-transform duration-300"
          [ngClass]="{ 'rotate-180': !isCollapsed }"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </button>

      <h3 class="text-xl font-bold text-violet-800 mb-3">üöÄ What You'll Learn</h3>
      <div
        [ngClass]="{
          'max-h-[100px]': isListCollapsed,
          'overflow-hidden': isListCollapsed,
          'max-h-full': !isListCollapsed
        }"
        class="transition-all duration-500"
      >
        <ul class="grid grid-cols-1 gap-x-6 gap-y-3 text-gray-700 list-none p-0">
          @for(conclusion of data?.conclusion; track conclusion; let i = $index){
          <li class="flex items-start">
            <svg
              class="w-5 h-5 text-green-500 mr-2 mt-1 flex-shrink-0"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"
              ></path>
            </svg>
            <span>{{ conclusion }}</span>
          </li>
          }
        </ul>
      </div>
      <button
        (click)="toggleList()"
        class="text-violet-700 font-semibold hover:text-violet-900 text-sm mt-3 flex items-center"
      >
        <span>{{ isListCollapsed ? 'Show All Topics' : 'Show Less' }}</span>

        <svg
          class="w-4 h-4 ml-1 transition-transform duration-300"
          [ngClass]="{ 'rotate-180': !isListCollapsed }"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 9l-7 7-7-7"
          ></path>
        </svg>
      </button>
    </div>
  </section>
</div>

<!-- Community Reviews & Comments -->
<section class="max-w-6xl mx-auto mt-12 pt-6 border-t-2 border-violet-100">
  <h2
    class="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-violet-950 via-violet-800 to-violet-900 mb-6"
  >
    Community Reviews & Comments
  </h2>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Submit Comments and Review form -->
    <div class="lg:col-span-1 p-6 bg-white rounded-xl border border-violet-200 shadow-lg h-fit">
      <h3 class="text-xl font-bold text-violet-800 mb-4">Leave a Comment</h3>

      <form class="space-y-4" [formGroup]="reviewForm" (submit)="submitReview()">
        <div>
          <label for="commentName" class="block text-sm font-medium text-gray-700">Your Name</label>
          <input
            type="text"
            id="commentName"
            placeholder="e.g., Happy Learner"
            formControlName="name"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 sm:text-sm p-2"
          />
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-800 mb-2"
            >Rating ({{ rating() }} Stars)</label
          >
          <div class="flex space-x-1">
            <!-- 2. Use @for loop for clickable stars -->
            @for (star of [1, 2, 3, 4, 5]; track star) {
            <svg
              (click)="selectRating(star)"
              [ngClass]="{
                'text-amber-500': star <= rating(),
                'text-gray-300 hover:text-amber-300': star > rating()
              }"
              class="w-8 h-8 cursor-pointer transition-colors duration-150"
              fill="currentColor"
              viewBox="0 0 20 20"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.955a1 1 0 00.95.691h4.16c.969 0 1.371 1.24.588 1.81l-3.374 2.454a1 1 0 00-.364 1.118l1.287 3.955c.3.921-.755 1.688-1.54 1.118l-3.374-2.454a1 1 0 00-1.176 0l-3.374 2.454c-.785.57-1.84-.197-1.54-1.118l1.287-3.955a1 1 0 00-.364-1.118L2.097 9.383c-.783-.57-.381-1.81.588-1.81h4.16a1 1 0 00.95-.691l1.286-3.955z"
              ></path>
            </svg>
            }
          </div>
          <!-- Simple Validation Feedback -->
          @if (reviewForm.controls['rating'].errors && reviewForm.controls['rating'].touched) {
          <p class="text-red-500 text-xs mt-1">A rating is required.</p>
          }
        </div>

        <div>
          <label for="commentText" class="block text-sm font-medium text-gray-700"
            >Your Comment</label
          >
          <textarea
            id="commentText"
            rows="4"
            placeholder="What did you think of the course?"
            formControlName="comment"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 sm:text-sm p-2"
          ></textarea>
          @if (reviewForm.controls['comment'].errors && reviewForm.controls['comment'].touched) {
          <p class="text-red-500 text-xs mt-1">A comment is required.</p>
          }
        </div>

        <button
          type="submit"
          [disabled]="reviewForm.invalid"
          class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-violet-600 hover:bg-violet-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-violet-500 transition duration-150"
        >
          Submit Review
        </button>
      </form>
    </div>

    <!-- Display Comments -->
    <div class="lg:col-span-2 space-y-6">
      <h3 class="text-xl font-bold text-violet-800">Latest Reviews (2 total)</h3>

      <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-sm">
        <div class="flex items-center justify-between mb-2">
          <p class="font-semibold text-gray-900">Emily R.</p>
          <div class="text-lg text-amber-400">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        </div>
        <p class="text-sm text-gray-700 italic mb-2">
          "Absolutely fantastic course! The Tailwind CSS section was clear and the final project
          helped solidify everything."
        </p>
        <span class="text-xs text-gray-500">Reviewed 2 days ago</span>
      </div>

      <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-sm">
        <div class="flex items-center justify-between mb-2">
          <p class="font-semibold text-gray-900">Mark T.</p>
          <div class="text-lg text-amber-400">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
        </div>
        <p class="text-sm text-gray-700 italic mb-2">
          "Great content for a beginner, though I wish there was a bit more on JavaScript. Highly
          recommend!"
        </p>
        <span class="text-xs text-gray-500">Reviewed 5 days ago</span>
      </div>

      <a href="#" class="text-violet-600 font-semibold hover:text-violet-800 text-sm block mt-4">
        See All 850 Reviews &rarr;
      </a>
    </div>
  </div>
</section>
